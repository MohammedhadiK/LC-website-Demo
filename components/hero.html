<section class="hero-banner relative overflow-hidden" x-data="{ mobileNavOpen: false }">
  <div data-component-src="components/hero/styles.html"></div>
  <div class="hero-bg" aria-hidden="true">
    <img src="bg-wbanner.png" alt="Listening Community banner background" data-hero-bg/>
  </div>
  <div data-component-src="components/hero/nav.html"></div>
  <div data-component-src="components/hero/content.html"></div>
  <div data-component-src="components/mobile-menu.html"></div>
  <script>
    (() => {
      const script = document.currentScript;
      if (!script) return;
      const section = script.parentElement;
      if (!section) return;
      const container = section.parentElement;
      if (!container) return;
      const dataset = container.dataset || {};

      if (dataset.bannerHideHero === 'true') {
        section.remove();
        return;
      }

      const syncHero = () => {
        const navLinks = section.querySelectorAll('.hero-links a');
        const titleEl = section.querySelector('[data-hero-title]');
        const descEl = section.querySelector('[data-hero-description]');
        const ctaEl = section.querySelector('[data-hero-cta]');
        const bgImageEl = section.querySelector('[data-hero-bg]');
        const copyWrapper = section.querySelector('.hero-copy');

        if (!navLinks.length || !titleEl || !copyWrapper) {
          requestAnimationFrame(syncHero);
          return;
        }

        const activePage = (dataset.bannerActivePage || '').toLowerCase();
        if (activePage) {
          console.log('[hero] active page from dataset:', activePage);
          navLinks.forEach((link) => {
            const href = (link.getAttribute('href') || '').toLowerCase();
            const normalized = href.replace('.html', '').replace('index', 'home');

            console.log('[hero] evaluating link', href, 'normalized to', normalized);

            if (normalized === activePage) {
              link.setAttribute('aria-current', 'page');
            } else {
              link.removeAttribute('aria-current');
            }
          });

          section.dataset.activePage = activePage;
          document.body.dataset.activePage = activePage;
          console.log('[hero] body dataset activePage set to', document.body.dataset.activePage);
          document.dispatchEvent(new CustomEvent('hero:active-page', {
            detail: { activePage }
          }));
        }

        if (dataset.bannerTitle) {
          titleEl.textContent = dataset.bannerTitle;
        }

        if (descEl) {
          if (dataset.bannerDescription) {
            descEl.textContent = dataset.bannerDescription;
          }
          if (dataset.bannerHideDescription === 'true') {
            descEl.remove();
          }
        }

        if (ctaEl) {
          if (dataset.bannerCtaText) {
            ctaEl.textContent = dataset.bannerCtaText;
          }
          if (dataset.bannerCtaLink) {
            ctaEl.setAttribute('href', dataset.bannerCtaLink);
          }
          if (dataset.bannerCtaTarget) {
            ctaEl.setAttribute('target', dataset.bannerCtaTarget);
          }
          if (dataset.bannerHideCta === 'true') {
            ctaEl.remove();
          }
        }

        if (bgImageEl && dataset.bannerImage) {
          bgImageEl.setAttribute('src', dataset.bannerImage);
          if (dataset.bannerImageAlt) {
            bgImageEl.setAttribute('alt', dataset.bannerImageAlt);
          }
        }

        const align = dataset.bannerAlign;
        copyWrapper.classList.remove('text-left', 'md:text-left', 'text-right', 'md:text-right');
        copyWrapper.classList.remove('mx-auto');
        copyWrapper.style.marginLeft = '';
        copyWrapper.style.marginRight = '';

        if (align === 'left') {
          copyWrapper.classList.add('text-left', 'md:text-left');
          copyWrapper.style.marginRight = 'auto';
        } else if (align === 'right') {
          copyWrapper.classList.add('text-right', 'md:text-right');
          copyWrapper.style.marginLeft = 'auto';
        } else {
          copyWrapper.classList.add('text-center');
          copyWrapper.style.marginLeft = 'auto';
          copyWrapper.style.marginRight = 'auto';
        }

        if (dataset.bannerMaxWidth) {
          copyWrapper.style.maxWidth = dataset.bannerMaxWidth;
        } else {
          copyWrapper.style.maxWidth = '';
        }
      };

      syncHero();
    })();
  </script>
</section>
