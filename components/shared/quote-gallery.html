<section class="py-12 lg:py-24 overflow-hidden">
  <style>
    .quote-gallery-marquee {
      position: relative;
      overflow-x: auto;
      overflow-y: hidden;
      scroll-snap-type: x proximity;
      cursor: grab;
      -webkit-overflow-scrolling: touch;
      scrollbar-width: none;
      -ms-overflow-style: none;
    }

    .quote-gallery-marquee.is-dragging {
      cursor: grabbing;
    }

    .quote-gallery-marquee::-webkit-scrollbar {
      display: none;
    }

    .quote-gallery-track {
      display: inline-flex;
      align-items: center;
      gap: 1.5rem;
      min-width: max-content;
    }

    .quote-gallery-item {
      flex: 0 0 auto;
      scroll-snap-align: center;
      width: clamp(160px, 20vw, 220px);
      height: clamp(160px, 20vw, 220px);
      border-radius: 1.25rem;
      overflow: hidden;
      transition: transform 0.4s ease;
    }

    .quote-gallery-image {
      width: 100%;
      height: 100%;
      object-fit: cover;
      filter: grayscale(100%);
      transition: transform 0.4s ease, filter 0.4s ease;
      display: block;
    }

    .quote-gallery-item:hover .quote-gallery-image,
    .quote-gallery-item:focus .quote-gallery-image,
    .quote-gallery-item:active .quote-gallery-image {
      filter: grayscale(0%);
      transform: scale(1.05);
    }

    @media (hover: none) {
      .quote-gallery-item {
        transition: none;
      }

      .quote-gallery-image {
        transition: none;
      }
    }

    /* Lightbox Modal Styles */
    .lightbox-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.95);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s ease, visibility 0.3s ease;
      cursor: pointer;
    }

    .lightbox-modal.active {
      opacity: 1;
      visibility: visible;
    }

    .lightbox-content {
      width: 100%;
      height: 100%;
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      transform: scale(0.9);
      transition: transform 0.3s ease;
    }

    .lightbox-modal.active .lightbox-content {
      transform: scale(1);
    }

    .lightbox-image {
      max-width: 100%;
      max-height: 100%;
      width: auto;
      height: auto;
      object-fit: contain;
      display: block;
    }

    .lightbox-close {
      position: fixed;
      top: 20px;
      right: 20px;
      background: rgba(255, 255, 255, 0.9);
      border: none;
      width: 44px;
      height: 44px;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 28px;
      color: #022C22;
      transition: transform 0.2s ease, background 0.2s ease;
      z-index: 10001;
      line-height: 1;
      font-weight: 300;
    }

    .lightbox-close:hover {
      transform: scale(1.1);
      background: rgba(255, 255, 255, 1);
    }

    .quote-gallery-item {
      cursor: pointer;
    }</style>
  <div class="container mx-auto px-4">
    <div class="quote-gallery-marquee" data-quote-gallery>
      <div class="quote-gallery-track">
        <div class="quote-gallery-item" tabindex="0">
          <img class="quote-gallery-image" src="images/Photos/images (1).webp" alt="Smiling volunteers offering support"/>
        </div>
        <div class="quote-gallery-item" tabindex="0">
          <img class="quote-gallery-image" src="images/Photos/images (2).webp" alt="Community members journaling together"/>
        </div>
        <div class="quote-gallery-item" tabindex="0">
          <img class="quote-gallery-image" src="images/Photos/images (3).webp" alt="Circle of friends sharing stories"/>
        </div>
        <div class="quote-gallery-item" tabindex="0">
          <img class="quote-gallery-image" src="images/Photos/images (4).webp" alt="Mentor encouraging participant"/>
        </div>
        <div class="quote-gallery-item" tabindex="0">
          <img class="quote-gallery-image" src="images/Photos/images (1).webp" alt="Smiling volunteers offering support"/>
        </div>
        <div class="quote-gallery-item" tabindex="0">
          <img class="quote-gallery-image" src="images/Photos/images (2).webp" alt="Community members journaling together"/>
        </div>
        <div class="quote-gallery-item" tabindex="-1" aria-hidden="true">
          <img class="quote-gallery-image" src="images/Photos/images (3).webp" alt=""/>
        </div>
        <div class="quote-gallery-item" tabindex="-1" aria-hidden="true">
          <img class="quote-gallery-image" src="images/Photos/images (4).webp" alt=""/>
        </div>
        <div class="quote-gallery-item" tabindex="-1" aria-hidden="true">
          <img class="quote-gallery-image" src="images/Photos/images (1).webp" alt=""/>
        </div>
        <div class="quote-gallery-item" tabindex="-1" aria-hidden="true">
          <img class="quote-gallery-image" src="images/Photos/images (2).webp" alt=""/>
        </div>
        <div class="quote-gallery-item" tabindex="-1" aria-hidden="true">
          <img class="quote-gallery-image" src="images/Photos/images (3).webp" alt=""/>
        </div>
        <div class="quote-gallery-item" tabindex="-1" aria-hidden="true">
          <img class="quote-gallery-image" src="images/Photos/images (4).webp" alt=""/>
        </div>
      </div>
    </div>
  </div>

  <!-- Lightbox Modal -->
  <div class="lightbox-modal" id="lightbox-modal">
    <div class="lightbox-content">
      <button class="lightbox-close" aria-label="Close lightbox">&times;</button>
      <img class="lightbox-image" src="" alt="" id="lightbox-image">
    </div>
  </div>
  <script>
    (() => {
      // Look for the container within the parent section, not just the previous sibling
      const container = document.currentScript?.parentElement?.querySelector('[data-quote-gallery]');
      if (!container) return;

      const track = container.querySelector('.quote-gallery-track');
      if (!track) return;

      let isDown = false;
      let isPaused = false;
      let startX = 0;
      let scrollLeft = 0;
      let resumeTimeout;
      let lastTime = 0;

      const pauseAutoScroll = (delay = 0) => {
        clearTimeout(resumeTimeout);
        if (delay <= 0) {
          isPaused = false;
        } else {
          isPaused = true;
          resumeTimeout = setTimeout(() => {
            isPaused = false;
          }, delay);
        }
      };

      container.addEventListener('pointerdown', (e) => {
        isDown = true;
        container.classList.add('is-dragging');
        container.setPointerCapture(e.pointerId);
        startX = e.clientX;
        scrollLeft = container.scrollLeft;
        pauseAutoScroll();
      });

      container.addEventListener('pointerleave', () => {
        if (!isDown) return;
        isDown = false;
        container.classList.remove('is-dragging');
        pauseAutoScroll();
      });

      container.addEventListener('pointerup', (e) => {
        if (container.hasPointerCapture(e.pointerId)) {
          container.releasePointerCapture(e.pointerId);
        }
        isDown = false;
        container.classList.remove('is-dragging');
        pauseAutoScroll();
      });

      container.addEventListener('pointermove', (e) => {
        if (!isDown) return;
        e.preventDefault();
        const walk = (e.clientX - startX) * 1.5;
        container.scrollLeft = scrollLeft - walk;
      });

      container.addEventListener('wheel', (e) => {
        if (Math.abs(e.deltaX) > Math.abs(e.deltaY)) {
          return;
        }
        container.scrollBy({ left: e.deltaY, behavior: 'smooth' });
        pauseAutoScroll(800);
        e.preventDefault();
      }, { passive: false });

      // Auto-scroll removed as requested
      // const AUTO_SPEED_PX_PER_SEC = 60;
      // const autoScroll = ...

      // Lightbox functionality
      const lightboxModal = document.getElementById('lightbox-modal');
      const lightboxImage = document.getElementById('lightbox-image');
      const lightboxClose = lightboxModal?.querySelector('.lightbox-close');
      const galleryItems = container.querySelectorAll('.quote-gallery-item');

      const openLightbox = (imageSrc, imageAlt) => {
        if (!lightboxModal || !lightboxImage) return;
        lightboxImage.src = imageSrc;
        lightboxImage.alt = imageAlt;
        lightboxModal.classList.add('active');
        document.body.style.overflow = 'hidden';
      };

      const closeLightbox = () => {
        if (!lightboxModal) return;
        lightboxModal.classList.remove('active');
        document.body.style.overflow = '';
      };

      let isDragging = false;
      let startXClick = 0;

      // Track drag state for click handling
      container.addEventListener('pointerdown', (e) => {
        isDragging = false;
        startXClick = e.clientX;
      });

      container.addEventListener('pointermove', (e) => {
        if (isDown) {
          const moveX = Math.abs(e.clientX - startXClick);
          if (moveX > 10) { // Threshold to consider it a drag
            isDragging = true;
          }
        }
      });

      // Add click handlers to all gallery items
      galleryItems.forEach(item => {
        item.addEventListener('click', (e) => {
          // If we were dragging, don't open lightbox
          if (isDragging) {
            e.preventDefault();
            e.stopPropagation();
            return;
          }

          const img = item.querySelector('.quote-gallery-image');
          if (img) {
            openLightbox(img.src, img.alt);
          }
        });

        // Keyboard accessibility
        item.addEventListener('keydown', (e) => {
          if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            const img = item.querySelector('.quote-gallery-image');
            if (img) {
              openLightbox(img.src, img.alt);
            }
          }
        });
      });

      // Close button
      if (lightboxClose) {
        lightboxClose.addEventListener('click', (e) => {
          e.stopPropagation();
          closeLightbox();
        });
      }

      // Click anywhere on modal to close (except the image itself)
      if (lightboxModal) {
        lightboxModal.addEventListener('click', (e) => {
          if (e.target === lightboxModal || e.target.classList.contains('lightbox-content')) {
            closeLightbox();
          }
        });
      }

      // ESC key to close
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && lightboxModal?.classList.contains('active')) {
          closeLightbox();
        }
      });
    })();
  </script>
</section>
