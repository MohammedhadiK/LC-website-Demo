<section id="contact-form" class="py-12 lg:py-24 relative overflow-hidden">
  <div class="container mx-auto px-4 relative">
    <div class="max-w-lg mx-auto">
      <div class="text-center mb-20">
        <h1 class="font-heading text-5xl sm:text-6xl md:text-7xl tracking-sm mb-6">Contact us</h1>
        <p class="text-lg text-gray-700 mb-16">
          We are here to help you make a first move to greener choice.
        </p>
      </div>
      <div class="p-8 bg-white rounded-2xl shadow-md">
        <form
          id="contactForm"
          action="#"
          data-endpoint="https://script.google.com/macros/s/AKfycbwTiWDeHq4khQo2kwf6lX5X9a2GyF_d1yc8rzvJLWTBlk-7cB36Khm9puez1bkwK4kHzQ/exec"
          method="post"
        >
          <label class="block pl-4 mb-1 text-sm font-medium" for="contact-name">Full Name</label>
          <input
            id="contact-name"
            class="w-full px-4 py-3 mb-6 outline-none ring-offset-0 focus:ring-2 focus:ring-lime-500 shadow rounded-full"
            type="text"
            name="name"
          />

          <label class="block pl-4 mb-1 text-sm font-medium" for="contact-email">Email</label>
          <input
            id="contact-email"
            class="w-full px-4 py-3 mb-6 outline-none ring-offset-0 focus:ring-2 focus:ring-lime-500 shadow rounded-full"
            type="email"
            name="email"
          />

          <label class="block pl-4 mb-1 text-sm font-medium" for="contact-company">
            <span>Company</span>
            <span class="text-gray-700">(optional)</span>
          </label>
          <input
            id="contact-company"
            class="w-full px-4 py-3 mb-6 outline-none ring-offset-0 focus:ring-2 focus:ring-lime-500 shadow rounded-full"
            type="text"
            name="company"
          />

          <label class="block pl-4 mb-1 text-sm font-medium" for="contact-service">Service</label>
          <div class="relative w-full mb-8 bg-white rounded-full">
            <span class="absolute top-1/2 right-0 mr-4 transform -translate-y-1/2">
              <svg
                width="20"
                height="20"
                viewBox="0 0 20 20"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M6.3999 8.2L9.9999 11.8L13.5999 8.2"
                  stroke="#646A69"
                  stroke-width="1.5"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                ></path>
              </svg>
            </span>
            <select
              id="contact-service"
              class="w-full px-4 py-3 text-gray-600 border rounded-full appearance-none cursor-pointer outline-none ring-offset-0 focus:ring-2 focus:ring-lime-500 bg-transparent relative"
              name="service"
            >
              <option value="">Select service</option>
              <option value="listening-support">Listening support</option>
              <option value="circle-facilitation">Circle facilitation</option>
              <option value="training">Training & workshops</option>
              <option value="partnerships">Partnerships</option>
            </select>
          </div>

          <button
            type="submit"
            class="flex w-full py-3 px-5 items-center justify-center font-medium text-white hover:text-teal-900 border border-teal-900 hover:border-lime-500 bg-teal-900 hover:bg-lime-500 rounded-full transition duration-200 disabled:opacity-60"
          >
            <span class="mr-2 flex items-center" data-label>Submit</span>
            <svg
              class="mr-2 text-white contact-spinner"
              data-loader
              width="20"
              height="20"
              viewBox="0 0 24 24"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
              style="display: none"
            >
              <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
              <path
                class="opacity-75"
                fill="currentColor"
                d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
              ></path>
            </svg>
            <svg
              width="21"
              height="20"
              viewBox="0 0 21 20"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
              data-icon
              style="display: inline"
            >
              <path
                d="M5.25 10H15.75"
                stroke="currentColor"
                stroke-width="1.5"
                stroke-linecap="round"
                stroke-linejoin="round"
              ></path>
              <path
                d="M10.5 4.75L15.75 10L10.5 15.25"
                stroke="currentColor"
                stroke-width="1.5"
                stroke-linecap="round"
                stroke-linejoin="round"
              ></path>
            </svg>
          </button>
          <p
            id="contactStatus"
            class="mt-4 text-center text-sm font-medium text-green-600 hidden"
            aria-live="polite"
          ></p>
        </form>
      </div>
    </div>
  </div>
</section>

<script>
  (function () {
    function initContactForm() {
      var form = document.getElementById('contactForm');
      if (!form) return;

      var submitBtn = form.querySelector('button[type="submit"]');
      if (!submitBtn) return;

      var label = submitBtn.querySelector('[data-label]');
      var loader = submitBtn.querySelector('[data-loader]');
      var icon = submitBtn.querySelector('[data-icon]');
      var statusEl = document.getElementById('contactStatus');
      var endpoint = form.dataset.endpoint || form.action;
      var isSubmitting = false;

      form.addEventListener('submit', function (event) {
        event.preventDefault();
        event.stopPropagation();
        if (isSubmitting) return;
        toggleLoading(true);
        setStatus('', true);

        fetch(endpoint, {
          method: 'POST',
          headers: {
            Accept: 'application/json'
          },
          body: new FormData(form)
        })
          .then(parseResponse)
          .then(function (result) {
            if (result.status === 'success') {
              form.reset();
              setStatus('Message sent successfully.', false, true);
            } else {
              throw new Error(result.message || 'Unable to send message.');
            }
          })
          .catch(function (error) {
            setStatus(error.message || 'Something went wrong. Please try again.', false, false);
          })
          .finally(function () {
            toggleLoading(false);
          });
      });

      function toggleLoading(isLoading) {
        isSubmitting = isLoading;
        submitBtn.setAttribute('aria-busy', isLoading ? 'true' : 'false');
        submitBtn.setAttribute('aria-disabled', isLoading ? 'true' : 'false');
        submitBtn.classList.toggle('pointer-events-none', isLoading);
        submitBtn.classList.toggle('opacity-60', isLoading);
        label.textContent = isLoading ? 'Sending...' : 'Submit';
        loader.style.display = isLoading ? 'inline-block' : 'none';
        icon.style.display = isLoading ? 'none' : 'inline-block';
      }

      function setStatus(message, hide, isSuccess) {
        if (hide || !message) {
          statusEl.classList.add('hidden');
          statusEl.textContent = '';
          return;
        }
        statusEl.textContent = message;
        statusEl.classList.remove('hidden');
        statusEl.classList.toggle('text-green-600', !!isSuccess);
        statusEl.classList.toggle('text-red-600', !isSuccess);
      }

      function parseResponse(response) {
        var contentType = response.headers.get('Content-Type') || '';
        if (contentType.indexOf('application/json') !== -1) {
          return response.json();
        }
        return response
          .text()
          .then(function (text) {
            if (!text) {
              return {};
            }
            try {
              return JSON.parse(text);
            } catch (err) {
              throw new Error(text.trim() || 'Unexpected response');
            }
          });
      }
    }

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initContactForm);
    } else {
      initContactForm();
    }
  })();
</script>

<style>
  .contact-spinner {
    animation: contact-spin 1s linear infinite;
  }

  @keyframes contact-spin {
    0% {
      transform: rotate(0deg);
    }
    100% {
      transform: rotate(360deg);
    }
  }
</style>
